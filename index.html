<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç•ªæ”¤åŠ©æ‰‹-æ·±åº¦åˆ†æå®Œå…¨ç‰ˆ</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; text-align: center; background: #f4f7f6; padding: 10px; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; border-top: 8px solid #28a745; }
        .win-gold { border-top: 8px solid #ffd700; background: #fffdf0; }
        .strategy-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-bottom: 15px; }
        .strategy-btn { background: #e9ecef; border: 1px solid #ddd; padding: 8px; font-size: 11px; cursor: pointer; border-radius: 5px; font-weight: bold; }
        .strategy-btn.active { background: #007bff; color: white; border-color: #0056b3; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 15px 0; }
        button.game-btn { padding: 18px; font-size: 22px; border: none; border-radius: 8px; cursor: pointer; background: #28a745; color: white; font-weight: bold; width: 100%; }
        button.game-btn:disabled { background: #ccc !important; cursor: not-allowed; }
        .status { margin-top: 15px; text-align: left; line-height: 1.8; border-top: 1px solid #eee; padding-top: 10px; font-size: 13px; }
        .highlight { color: #d9534f; font-weight: bold; font-size: 1.6em; }
        .info-box { padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #ddd; display: none; font-size: 13px; font-weight: bold; }
        .log { font-size: 12px; color: #333; height: 180px; overflow-y: scroll; border: 1px solid #ddd; padding: 10px; margin-top: 10px; background: #fafafa; text-align: left; font-family: monospace; }
        .btn-group { display: flex; gap: 5px; margin-top: 10px; }
        .save-btn { background: #28a745; color: white; border: none; padding: 12px; border-radius: 5px; flex: 1; cursor: pointer; font-weight: bold; }
        .reset-btn { background: #6c757d; color: white; border: none; padding: 12px; border-radius: 5px; flex: 1; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>
    <div id="main-card" class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom:10px;">
            <span id="mode-title" style="font-weight: bold;">æ™ºæ…§åŠ©æ‰‹ (æ·±åº¦åˆ†æç‰ˆ)</span>
            <span style="color:#007bff; font-weight:bold;">ç¬¬ <span id="display-round">0</span> å±€</span>
        </div>

        <div class="strategy-grid">
            <button class="strategy-btn" id="btnA" onclick="setStrat('A')">A é¿è·³</button>
            <button class="strategy-btn" id="btnB" onclick="setStrat('B')">B è¿½é¾</button>
            <button class="strategy-btn" id="btnC" onclick="setStrat('C')">C è²·å†·</button>
            <button class="strategy-btn" id="btnD" onclick="setStrat('D')">D è²·ç†±</button>
            <button class="strategy-btn active" id="btnE" onclick="setStrat('E')">E åå‘</button>
            <button class="strategy-btn" id="btnF" onclick="setStrat('F')">F å¹³è¡¡</button>
        </div>
        
        <div id="status-warning" class="info-box"></div>

        <div id="bet-area">
            <p style="margin:5px 0;">ä¸‹ä¸€å±€æ³¨ç¢¼ï¼š<span class="highlight" id="next-bet">0</span> <small id="ladder-hint" style="color:#666;"></small></p >
            <p style="margin:5px 0;">å»ºè­°æŠ•æ³¨ï¼š<span class="highlight" id="next-target">è§€å¯Ÿä¸­</span></p >
        </div>

        <div class="grid">
            <button class="game-btn" onclick="record(1)">1</button>
            <button class="game-btn" onclick="record(2)">2</button>
            <button class="game-btn" onclick="record(3)">3</button>
            <button class="game-btn" onclick="record(4)">4</button>
        </div>

        <div class="status">
            <div style="display:flex; justify-content:space-between;">
                <span>é¤˜é¡ï¼š<span id="current-balance" style="font-weight:bold; color:#007bff;">10000</span></span>
                <span>ç›ˆè™§: <span id="total-profit" style="font-weight:bold;">0.0</span></span>
            </div>
            <div style="display:flex; justify-content:space-between; font-size: 11px;">
                <span style="color:#dc3545; font-weight:bold;">å›æ’¤: <span id="mdd-percent">0%</span></span>
                <span>é«˜å³°ç›ˆè™§: <span id="peak-val">0</span></span>
            </div>
        </div>
        
        <div class="log" id="log">--- ç­‰å¾…é–‹ç ---</div>
        
        <div class="btn-group">
            <button class="save-btn" onclick="exportToCSV()">ğŸ’¾ æ·±åº¦åˆ†æå°å‡º</button>
            <button class="reset-btn" onclick="confirmReset()">ğŸ” é‡ç½®æ•¸æ“š</button>
        </div>
    </div>

    <script>
        let baseCapital = 10000;
        let ladderFull = [100, 300, 700, 1500, 3100];
        let ladderShort = [100, 300, 700];
        let round, currentStep, totalProfit, counts, history, currentStrat, peakProfit, maxDrawdown, winTargetReached, logData;
        let totalWagered, totalCommission, stratTracks, winCount, loseCount, pauseCount, winWagered, loseWagered, currentTarget;

        function init() {
            round = 0; currentStep = 0; totalProfit = 0; counts = {1:0, 2:0, 3:0, 4:0};
            history = []; peakProfit = 0; maxDrawdown = 0; winTargetReached = false; logData = [];
            totalWagered = 0; totalCommission = 0; stratTracks = [];
            winCount = 0; loseCount = 0; pauseCount = 0; winWagered = 0; loseWagered = 0;
            currentTarget = [];
            setStrat('E');
            enableButtons();
            document.getElementById('main-card').className = "card";
            updateUI();
            document.getElementById('log').innerHTML = "--- æ•¸æ“šå·²é‡ç½® ---";
            showWarning("");
        }

        function setStrat(s) {
            currentStrat = s;
            stratTracks.push({ r: round, strat: s, profit: totalProfit.toFixed(1) });
            document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn' + s).classList.add('active');
            currentStep = 0;
            calculateTarget();
        }

        function calculateTarget() {
            if (winTargetReached) return;
            let last = history.length > 0 ? history[history.length - 1] : null;
            let isStreak = history.length >= 3 && history.slice(-3).every(x => x === last);
            
            if (isStreak && ['A', 'C', 'E'].includes(currentStrat)) {
                showWarning("âš ï¸ é€£è™Ÿæš«åœ (é˜²ç¦¦æ¨¡å¼)", "background:#fff3cd; color:#856404;");
                currentTarget = []; document.getElementById('next-target').innerText = "é€£è™Ÿæš«åœ";
                return;
            }
            showWarning("");

            let sample = history.slice(-12);
            let heat = {1:0, 2:0, 3:0, 4:0};
            sample.forEach(n => heat[n]++);
            let sortedByHeat = [1,2,3,4].sort((a,b) => heat[b] !== heat[a] ? heat[b] - heat[a] : counts[a] - counts[b]);

            if (currentStrat === 'E') {
                if (history.length < 3) { currentTarget = []; document.getElementById('next-target').innerText = `è§€å¯Ÿ(${history.length}/3)`; }
                else {
                    let coldVal = Math.max(...Object.values(counts));
                    let colds = [1,2,3,4].filter(n => counts[n] === coldVal);
                    currentTarget = (colds.length === 1) ? [1,2,3,4].filter(n => n !== colds[0] && n !== last).sort() : [];
                    document.getElementById('next-target').innerText = currentTarget.length ? "è§’ " + currentTarget.join(",") : "å†·è™Ÿä¸å”¯ä¸€";
                }
            } else if (currentStrat === 'D') {
                currentTarget = sortedByHeat.slice(0, 2).sort();
                document.getElementById('next-target').innerText = "ç†±å€è§’ " + currentTarget.join(",");
            } else if (currentStrat === 'B') {
                currentTarget = last ? [last, sortedByHeat.filter(n => n !== last)[0]].sort() : [1,2];
                document.getElementById('next-target').innerText = "è¿½é¾è§’ " + currentTarget.join(",");
            } else if (currentStrat === 'A') {
                currentTarget = sortedByHeat.filter(n => n !== last).slice(0, 2).sort();
                document.getElementById('next-target').innerText = "é¿è·³è§’ " + currentTarget.join(",");
            } else if (currentStrat === 'C') {
                currentTarget = [1,2,3,4].sort((a,b) => counts[b] - counts[a]).slice(0, 2).sort();
                document.getElementById('next-target').innerText = "è²·å†·è§’ " + currentTarget.join(",");
            } else if (currentStrat === 'F') {
                let coldOne = [1,2,3,4].sort((a,b) => counts[b] - counts[a])[0];
                currentTarget = (last && last !== coldOne) ? [last, coldOne].sort() : sortedByHeat.slice(0, 2).sort();
                document.getElementById('next-target').innerText = "å¹³è¡¡è§’ " + currentTarget.join(",");
            }
            refreshNextBetDisplay();
        }

        function record(num) {
            if (winTargetReached) return;
            let currentLadder = (currentStrat === 'E') ? ladderShort : ladderFull;
            let isBetting = currentTarget && currentTarget.length > 0;
            let nextBet = isBetting ? currentLadder[currentStep] : 0;
            
            if (isBetting && (baseCapital + totalProfit) < nextBet) {
                showWarning(`ğŸ”´ é¤˜é¡ä¸è¶³ (${nextBet})`, "background:#f8d7da; color:#721c24;");
                disableButtons(); return;
            }

            let isWin = isBetting && currentTarget.includes(num);
            let roundProfit = isBetting ? (isWin ? nextBet * 0.95 : -nextBet) : 0;

            if (isBetting) {
                totalWagered += nextBet;
                if (isWin) { totalCommission += nextBet * 0.05; winCount++; winWagered += nextBet; }
                else { loseCount++; loseWagered += nextBet; }
            } else { pauseCount++; }

            totalProfit += roundProfit;
            peakProfit = Math.max(peakProfit, totalProfit);
            maxDrawdown = Math.max(maxDrawdown, peakProfit - totalProfit);
            
            logData.push({ r: round + 1, strat: currentStrat, bet: nextBet, target: isBetting ? currentTarget.join(",") : "â¸ï¸", open: num, profit: roundProfit.toFixed(1), balance: (baseCapital + totalProfit).toFixed(0) });
            writeLog(round + 1, nextBet, isBetting ? currentTarget.join(",") : "â¸ï¸", num, isWin, roundProfit);
            
            if (isBetting) { if (isWin) currentStep = 0; else { currentStep++; if (currentStep >= currentLadder.length) currentStep = 0; } }
            history.push(num); round++; [1,2,3,4].forEach(n => n === num ? counts[n] = 0 : counts[n]++);
            if (totalProfit >= 5000) winTargetReached = true;
            calculateTarget(); updateUI();
        }

        function writeLog(r, b, t, o, win, p) {
            let logBox = document.getElementById('log');
            if (logBox.innerHTML.includes("---")) logBox.innerHTML = "";
            let res = b === 0 ? "â¸ï¸" : (win ? "âœ…" : "âŒ");
            logBox.innerHTML = `<div>(${r}) [${currentStrat}] ${b} | ${t} é–‹:${o} ${res} ${(p>=0?"+":"")+p.toFixed(0)}</div>` + logBox.innerHTML;
        }

        function updateUI() {
            let card = document.getElementById('main-card');
            if (totalProfit >= 5000) { card.className = "card win-gold"; disableButtons(); }
            document.getElementById('display-round').innerText = round;
            document.getElementById('current-balance').innerText = (baseCapital + totalProfit).toFixed(0);
            document.getElementById('total-profit').innerText = totalProfit.toFixed(1);
            let mddP = (maxDrawdown / (baseCapital + (peakProfit > 0 ? peakProfit : 0))) * 100;
            document.getElementById('mdd-percent').innerText = mddP.toFixed(1) + "%";
            document.getElementById('peak-val').innerText = peakProfit.toFixed(0);
            refreshNextBetDisplay();
        }

        function refreshNextBetDisplay() {
            let currentLadder = (currentStrat === 'E') ? ladderShort : ladderFull;
            document.getElementById('next-bet').innerText = winTargetReached ? "æ­¢è´" : (currentTarget.length === 0 ? "0" : currentLadder[currentStep]);
            document.getElementById('ladder-hint').innerText = (currentStrat === 'E') ? "(1-3-7)" : "(1-3-7-15-31)";
        }

        function exportToCSV() {
            if (logData.length === 0) return;
            let now = new Date();
            let fileName = `ç•ªæ”¤æ·±åº¦åˆ†æ_${now.getHours()}${now.getMinutes()}.csv`;
            let csv = "\uFEFFå±€æ•¸,ç­–ç•¥,ä¸‹æ³¨,çµ„åˆ,é–‹ç,ç›ˆè™§,é¤˜é¡\n";
            logData.forEach(r => csv += `${r.r},${r.strat},${r.bet},"${r.target}",${r.open},${r.profit},${r.balance}\n`);
            
            csv += `\n--- è²¡å‹™æ·±åº¦æŒ‡æ¨™ ---\n`;
            csv += `æœ€çµ‚é¤˜é¡,${(baseCapital + totalProfit).toFixed(0)},ç¸½ç›ˆè™§,${totalProfit.toFixed(1)},ç¸½æµæ°´,${totalWagered.toFixed(0)}\n`;
            csv += `é«˜å³°ç›ˆè™§,${peakProfit.toFixed(0)},æœ€å¤§å›æ’¤é¡,${maxDrawdown.toFixed(0)},ä»˜å‡ºæ²¹æ°´,${totalCommission.toFixed(1)}\n`;
            
            csv += `\n--- å‹ç‡èˆ‡æµæ°´ç´°ç¯€ ---\n`;
            let totalGames = winCount + loseCount;
            csv += `ä¸­çæ¬¡æ•¸,${winCount},ä¸­çæµæ°´,${winWagered.toFixed(0)},å‹ç‡,${totalGames? (winCount/totalGames*100).toFixed(1):0}%\n`;
            csv += `æ²’ä¸­æ¬¡æ•¸,${loseCount},æå¤±æµæ°´,${loseWagered.toFixed(0)},æ•—ç‡,${totalGames? (loseCount/totalGames*100).toFixed(1):0}%\n`;
            csv += `æš«åœå±€æ•¸,${pauseCount}\n`;

            csv += `\n--- ç­–ç•¥åˆ†é …è²¢ç» ---\nç­–ç•¥,ä¸‹æ³¨å±€æ•¸,æ·¨ç›ˆè™§\n`;
            ['A','B','C','D','E','F'].forEach(s => {
                let sD = logData.filter(d => d.strat === s && d.bet > 0);
                let sP = sD.reduce((a, b) => a + parseFloat(b.profit), 0);
                csv += `${s},${sD.length},${sP.toFixed(1)}\n`;
            });

            csv += `\n--- è™Ÿç¢¼åˆ†ä½ˆçµ±è¨ˆ ---\nè™Ÿç¢¼,æ¬¡æ•¸,ä½”æ¯”\n`;
            [1,2,3,4].forEach(n => {
                let c = history.filter(x=>x===n).length;
                csv += `${n},${c},${history.length?(c/history.length*100).toFixed(1):0}%\n`;
            });

            let blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.setAttribute("download", fileName);
            link.click();
        }

        function confirmReset() { if (confirm("ç¢ºå®šé‡ç½®æ‰€æœ‰æ•¸æ“šï¼Ÿ")) init(); }
        function showWarning(m, s) { let b = document.getElementById('status-warning'); if (m) { b.style.display = 'block'; b.innerText = m; b.style.cssText += s; } else { b.style.display = 'none'; } }
        function disableButtons() { document.querySelectorAll('.game-btn').forEach(b => b.disabled = true); }
        function enableButtons() { document.querySelectorAll('.game-btn').forEach(b => b.disabled = false); }

        window.onload = init;
    </script>
</body>
</html>
